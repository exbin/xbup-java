<html>
  <head>
    <link href="../../style.css" rel="stylesheet" type="text/css">
    <title>    </title>
    
  </head>
  <body>
    <p class="heading1">
      Implementing image storage
    </p>
    <p>
      To enable image reference manipulation functionality as described in the <a href="../../topic16/topic128/topic130.htm">
next chapter</a>, maintenance of an <a href="../../topic16/topic128/topic129.htm">
image repository</a> is required. The following parts have been created to 
      support image repository maintenance:
    </p>
    <p>
      
    </p>
    <table style=" width:80%; background-color:#ffffff;">
      <tr>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#cccccc; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            Class, Method, Field
          </p>
        </td>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#cccccc; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            Description
          </p>
        </td>
      </tr>
      <tr>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            FrmMain.appTempDir
          </p>
        </td>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            new field referencing the temporary directory of application 
            SimplyHTML
          </p>
        </td>
      </tr>
      <tr>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            FrmMain.initAppTempDir()
          </p>
        </td>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            method to initialize the temporary directory of application 
            SimplyHTML
          </p>
        </td>
      </tr>
      <tr>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            FrmMain.getAppTempDir()
          </p>
        </td>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            method to get the directory for temporary storage of application 
            SimplyHTML
          </p>
        </td>
      </tr>
      <tr>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            DocumentPane.getImageDir()
          </p>
        </td>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            method to get the image directory for a particular document open 
            in SimplyHTML
          </p>
        </td>
      </tr>
      <tr>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            DocumentPane.saveImages()
          </p>
        </td>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            method to save images at a new location
          </p>
        </td>
      </tr>
      <tr>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            Util.copyFile()
          </p>
        </td>
        <td style=" text-align:left; width:50%; border-right-width:0pt; padding-right:4pt; padding-bottom:2pt; border-left-width:0pt; margin-left:1pt; margin-right:1pt; margin-bottom:1pt; background-color:#e9e7e7; padding-left:4pt; padding-top:0pt; border-bottom-width:0pt; margin-top:1pt; border-top-width:0pt;" valign="top">
          <p class="table">
            method to copy files
          </p>
        </td>
      </tr>
    </table>
    <p>
      
    </p>
    <p>
      Generally speaking, an image repository always is kept with the document 
      it belongs to. Whenever a document is saved, the image directory of the 
      document is saved at the same location, necessarily copying image files 
      as described below.
    </p>
    <p class="heading2">
      Methods initAppTempDir and getAppTempDir
    </p>
    <p>
      With method <font face="'Courier New',Monospaced,Monospace">
      initAppTempDir</font> of class <font face="'Courier New',Monospaced,Monospace">
FrmMain</font> new field <font face="'Courier New',Monospaced,Monospace">
      appTempDir</font> is initialized. The method creates a file object 
      referencing a directory named <font face="'Courier New',Monospaced,Monospace">
[user home]/SimplyHTML/temp</font>. If the directory does not exist it is 
      created by method <font face="'Courier New',Monospaced,Monospace">
      initAppTempDir</font>.
    </p>
    <p>
      Method <font face="'Courier New',Monospaced,Monospace">getAppTempDir</font>
 publicly makes available field <font face="'Courier New',Monospaced,Monospace">
appTempDir</font> for read only access.
    </p>
    <p class="heading2">
      Method saveImages
    </p>
    <p>
      In class <font face="'Courier New',Monospaced,Monospace">DocumentPane</font>
 documents are being saved with method <font face="'Courier New',Monospaced,Monospace">
saveDocument</font>. With the new image support of stage 7 of SImplyHTML 
      document storage has to be extended by a method to save any image files 
      referenced in a particular document.
    </p>
    <p>
      New method <font face="'Courier New',Monospaced,Monospace">saveImages</font>
 of class <font face="'Courier New',Monospaced,Monospace">DocumentPane</font> 
      is called by method <font face="'Courier New',Monospaced,Monospace">
      saveDocument</font> for this task. It uses new method <font face="'Courier New',Monospaced,Monospace">
getImageDir</font> (see below) to find out the source location of any image 
      files. It then copies all image files to the location, the document is 
      being saved to using method <font face="'Courier New',Monospaced,Monospace">
copyFile</font> of class <font face="'Courier New',Monospaced,Monospace">Util</font>
 (see below).
    </p>
    <p class="heading3">
      Method getImageDir
    </p>
    <p>
      Method <font face="'Courier New',Monospaced,Monospace">getImageDir</font>
       finds out the source location of image files for a document to be 
      saved. The method checks whether images are currently stored in a 
      temporary directory for a given document. If the document was not newly 
      created, <font face="'Courier New',Monospaced,Monospace">getImageDir</font>
 finds out if the document is about to be saved at a new location (save as) or 
      if it is being saved at the location it was loaded from (save) in which 
      cases the source locations are to be taken from different locations in 
      class <font face="'Courier New',Monospaced,Monospace">DocumentPane</font>
       .
    </p>
    <p>
      The source image directory is returned to the calling method.
    </p>
    <p class="heading2">
      Method copyFile
    </p>
    <p>
      Method <font face="'Courier New',Monospaced,Monospace">copyFile</font> 
      in class <font face="'Courier New',Monospaced,Monospace">Util</font> is 
      a simple way to copy a file from one location to another. It accepts two 
      file objects as parameters for the source and destination file to be 
      copied. It opens <font face="'Courier New',Monospaced,Monospace">
      RandomAccessFile</font> objects for the two files and creates the 
      destination file if necessary. It then reads blocks of content bytes 
      from the source file and writes them to the destination file.
    </p>
    <p>
      If the destination file already exists, <font face="'Courier New',Monospaced,Monospace">
copyFile</font> does nothing.
    </p>
  </body>
</html>
